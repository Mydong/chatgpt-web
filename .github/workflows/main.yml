name: Build Docker Image

on:
  push:
    branches:
      - main
  pull_request:

jobs:
  build:
    name: Build Docker Image
    runs-on: ubuntu-latest
    steps:
  - name: Checkout code
    uses: actions/checkout@v2

  - name: Build Docker image
    uses: docker/build-push-action@v2
    with:
      context: .
      file: ./ChatGPT/Dockerfile
      push: false
      tags: mydockerregistry/chatgpt:latest

  - name: Save Docker image
    run: docker save -o chatgpt.tar mydockerregistry/chatgpt:latest

  - name: Upload Docker image
    uses: actions/upload-artifact@v2
    with:
      name: chatgpt-image
      path: ./chatgpt.tar

  - name: Cleanup
    run: rm chatgpt.tar
